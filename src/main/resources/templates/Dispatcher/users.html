<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="shortcut icon" href="../icon.png" type="image/x-icon">
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
    <!--Сортировка, поиск по таблице-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.16/sorting/datetime-moment.js"></script>
    <script>
        $(document).ready(function () {
            $('#table1').DataTable({
                language: {
                    url: "https://cdn.datatables.net/plug-ins/1.10.21/i18n/Russian.json",
                },
                // "bLengthChange": false,
                "pageLength": 25,
            });
        });

        function clickedToDelete(id) {
            var sured = confirm("Вы уверены, что хотите удалить пользователя №" + id + "? Это действие невозможно отменить!");
            if (sured) {
                location.href = "remove_user?id=" + id;
            }
        }
    </script>
    <style>.cl-btn-4 {
        width: 1.2em;
        height: 1.2em;
        box-shadow: 0 1px 2px 1px rgba(0, 0, 0, 0.25);
        border-radius: 1px;
        background: #337AB7;
        margin: 0.2em auto;
        position: relative;
        display: block;
        z-index: 200;
        text-indent: -9999px;
        cursor: pointer;
    }
    .cl-btn-4:before,
    .cl-btn-4:after {
        content: '';
        width: 80%;
        height: 0.1em;
        background: #BFE2FF;
        position: absolute;
        top: 48%;
        left: 10%;
        transform: rotate(45deg);
        transition: all 0.3s ease-out;
    }
    .cl-btn-4:after {
        transform: rotate(-45deg);
        transition: all 0.3s ease-out;
    }
    .cl-btn-4:hover:before,
    .cl-btn-4:hover:after {
        transform: rotate(180deg);
        background: #FFF;
    }
    </style>
</head>
<body>
<div class="row" style="display: flex;justify-content: space-between;width: 100%">
    <div style="padding-left: 1em"><h1>Пользователи</h1></div>
    <form style="padding-top: 0.4em" th:action="@{/logout}" method="post">
        <button class="btn-sm btn-secondary" type="submit">Log out</button>
    </form>
</div>
<div class="container" th:if="${LoggedRole==T(com.practice3.reporter.EnumRole).SUPERUSER}">
    <form enctype="multipart/form-data" th:action="@{/add_user}" th:object="${newUser}"
          method="post"
          class="needs-validation">
        <small style="color: red" th:if="${errorMessage!=null}"
               th:text="${errorMessage}"></small>
        <div class="row">
            <div class="col-md-12">
                <div class="row">

                    <div class="col-md-4 mb-1">
                        <label for="username">Никнейм</label>
                        <input th:field="*{username}" type="text" class="form-control" id="username"
                               required>
                    </div>

                    <div class="col-md-4 mb-1">
                        <label for="password">Пароль</label>
                        <input th:field="*{password}" type="text" class="form-control" id="password" required>
                    </div>

                    <div class="col-md-4 mb-1">
                        <label for="role">Роль</label>
                        <select name="role" th:field="*{role}" class="form-control" id="role" required
                                th:default="${T(com.practice3.reporter.EnumRole).DISPATCHER}">
                            <option th:each="roleOpt : ${T(com.practice3.reporter.EnumRole).values()}"
                                    th:value="${roleOpt}" th:text="${roleOpt.getDisplayValue()}"></option>
                        </select>
                    </div>
                </div>

                <div class="row">

                    <div class="col-md-4 mb-2">
                        <label for="surname">Фамилия</label>
                        <input th:field="${newCoordinator.surname}" type="text" class="form-control" id="surname" required>
                    </div>

                    <div class="col-md-4 mb-2">
                        <label for="name">Имя</label>
                        <input th:field="${newCoordinator.name}" type="text" class="form-control" id="name" required>
                    </div>

                    <div class="col-md-4 mb-2">
                        <label for="patronymic">Отчество</label>
                        <input th:field="${newCoordinator.patronymic}" type="text" class="form-control" id="patronymic" required>
                    </div>
                </div>

                <button class="btn btn-secondary btn btn-block mb-3" type="submit" value="Submit">
                    Добавить пользователя
                </button>
            </div>
        </div>
    </form>
</div>
<div>
    <table id="table1" class="table table-striped table-hover">
        <thead class="thead-light">
        <tr>
            <th class="text-justify">ID</th>
            <th class="text-justify">Никнейм</th>
            <th class="text-justify">Пароль</th>
            <th class="text-justify">Роль</th>
            <th class="text-justify">ФИО</th>
            <th style="width: 1em" class="text-justify"></th>
            <th style="width: 1em" class="text-justify" th:if="${LoggedRole==T(com.practice3.reporter.EnumRole).SUPERUSER}"></th>
        </tr>
        </thead>
        <tbody>

        <tr th:each="object : ${list}">
            <td class="align-middle"><span th:text="${object.getUser().id}"></span></td>
            <td class="align-middle"><span th:text="${object.getUser().username}"></span></td>
            <td class="align-middle"><span th:text="${object.getUser().getShortPassword()}"></span></td>
            <td class="align-middle"><span th:text="${object.getUser().role.getDisplayValue()}"></span></td>
            <td class="align-middle"><span th:if="${object.getCoordinator()!=null}"
                                           th:text="${object.getCoordinator().getShortName()}"></span></td>
            <td>
                <form th:if="${LoggedUsername.equals(object.getUser().username)||LoggedRole==T(com.practice3.reporter.EnumRole).SUPERUSER}"
                      th:action="@{/update_user}" method="post"
                      th:onsubmit="return confirm
                  ('Вы уверены, что хотите удалить пользователя [[${object.getCoordinator().getFullName()}]] (id=[[${object.user.id}]])?')">
                    <input type="hidden" name="id" th:value="${object.user.id}"/>
                    <input type="hidden" name="action" value="update"/>
                    <button type="submit"><i class="fa fa-pencil" aria-hidden="true"></i></button>
                </form>
            </td>
            <td>
                <form th:if="${LoggedRole==T(com.practice3.reporter.EnumRole).SUPERUSER}"
                      th:action="@{/update_user}" method="post"
                      th:onsubmit="return confirm
                  ('Вы уверены, что хотите удалить пользователя [[${object.getCoordinator().getFullName()}]] (id=[[${object.user.id}]])?')">
                    <input type="hidden" name="id" th:value="${object.user.id}"/>
                    <input type="hidden" name="action" value="delete"/>
                    <button type="submit" class="cl-btn-4"></button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>